<%- simple_files = @files.select { |f| f.text? } %>

<%- if defined?(current) && current.respond_to?(:page_name) %>
  <%- dir = current.full_name[%r{\A[^/]+(?=/)}] || current.page_name %>
<%- end %>

<%- unless simple_files.empty? then %>
  <div id="fileindex-section" class="nav-section">
    <details class="nav-section-collapsible" <%= 'open' unless @inside_class_file %>>
      <summary class="nav-section-header">
        <span class="nav-section-icon">
          <svg>
            <use href="#icon-file"></use>
          </svg>
        </span>

        <span class="nav-section-title">Pages</span>

        <span class="nav-section-chevron">
          <svg>
            <use href="#icon-chevron"></use>
          </svg>
        </span>
      </summary>

      <ul class="nav-list">
        <%- grouped_files = simple_files.group_by { |f| f.full_name[%r{\A[^/]+(?=/)}] || f.page_name } %>

        <%- grouped_files.each do |n, files| %>
          <%- f = files.shift %>

          <%- if files.empty? %>
            <li>
              <a href="<%= rel_prefix %>/<%= h f.path %>">
                <%= h f.page_name %>
              </a>
            </li>
            <%- next -%>
          <%- end %>

          <li>
            <details <%= dir == n ? ' open' : '' %>>
              <summary>
                <% if n == f.page_name %>
                  <a href="<%= rel_prefix %>/<%= h f.path %>"><%= h n %></a>
                <% else %>
                  <%= h n %>
                  <% files.unshift(f) %>
                <% end %>
              </summary>

              <ul class="link-list">
                <%- files.each do |f| %>
                  <li>
                    <a href="<%= rel_prefix %>/<%= h f.path %>">
                      <%= h f.page_name %>
                    </a>
                  </li>
                <%- end %>
              </ul>
            </details>
          </li>
        <%- end %>
      </ul>
    </details>
  </div>
<%- end %>
